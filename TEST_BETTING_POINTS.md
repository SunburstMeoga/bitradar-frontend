# 下注点功能测试指南

## 功能概述

在 Trade 页面点击 Up 或 Down 按钮后，会在折线图上生成一个下注点、结算虚线和连接线，这些元素会随着折线图移动，并在 60 秒后自动消失。

## 测试步骤

### 1. 启动应用

```bash
npm run dev
```

访问 http://localhost:5174/

### 2. 基本功能测试

1. 在 Trade 页面，确保交易金额不为 0（默认为 1）
2. 点击绿色的"Up"按钮
3. 观察：

   - 页面上方应该显示"当前下注数量: 1"
   - 控制台应该显示下注信息
   - 图表上应该出现：
     - 一个绿色圆点（20px），中间有白色向上三角形
     - 一条绿色垂直虚线（在图表右侧，表示 60 秒后的结算时间）
     - 一条绿色实线连接下注点和虚线
     - 虚线与实线交点处有一个绿色小圆点（10px）

4. 再点击红色的"Down"按钮
5. 观察：
   - 页面显示"当前下注数量: 2"
   - 图表上应该出现第二套红色的下注点、虚线、连接线和连接点

### 3. 移动测试

1. 等待几秒钟
2. 观察所有元素（下注点、虚线、连接线、连接点）是否一起随着图表的滑动窗口向左移动
3. 下注点应该保持在对应的价格水平线上
4. 虚线应该保持垂直，连接线应该保持水平

### 4. 开盘清理测试

1. 等待 60 秒（开盘时间）
2. 观察所有下注相关元素（下注点、虚线、连接线、连接点）是否同时消失
3. 页面上的"当前下注数量"应该变为 0 或消失

## 预期结果

### 下注点外观

- **尺寸**: 20px × 20px 圆形（已升级）
- **Up 方向**: 绿色背景(#00bc4b) + 白色向上三角形
- **Down 方向**: 红色背景(#f5384e) + 白色向下三角形
- **三角形**: 宽度 8px（已升级）

### 结算虚线

- **样式**: 垂直虚线，从图表顶部到底部
- **位置**: 下注时间 + 60 秒的时间点
- **颜色**: 与下注点颜色一致

### 连接线和连接点

- **连接线**: 水平实线，连接下注点和结算虚线
- **连接点**: 10px 圆形，位于虚线与连接线交点
- **颜色**: 与下注点颜色一致

### 下注点行为

- 出现在下注时的 BTC 价格位置
- 所有元素（下注点、虚线、连接线、连接点）一起随着图表滑动窗口移动
- 60 秒后（开盘时间）自动清理

### 控制台输出

- Trade 页面: "🎯 用户下注: {bet 对象}"
- PriceChart: "📊 PriceChart 收到 userBets: [bet 数组]"
- PriceChart: "🎨 绘制用户下注点: X 个点"

## 故障排除

### 如果下注点不显示

1. 检查控制台是否有错误
2. 确认交易金额不为 0
3. 确认 userBets 数据是否正确传递
4. 检查 Chart.js 插件是否正确注册

### 如果下注点位置不正确

1. 检查时间戳计算逻辑
2. 确认价格数据是否正确
3. 检查坐标转换逻辑

## 技术实现

### 关键组件

- `src/pages/Trade/index.jsx`: 处理用户下注
- `src/components/PriceChart/index.jsx`: 绘制下注点

### 关键函数

- `handlePlaceBet()`: 创建下注记录
- `userBetsPlugin`: Chart.js 插件，绘制下注点
- `drawBetPoint()`: 绘制单个下注点

### 数据流

1. 用户点击 Up/Down → `handlePlaceBet()` → 更新`userBets`状态
2. `userBets`作为 props 传递给`PriceChart`
3. `PriceChart`将`userBets`传递给 Chart.js options
4. `userBetsPlugin`在图表渲染后绘制下注点
