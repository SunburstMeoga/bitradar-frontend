# Trade 页面功能文档

## 📋 概述

Trade 页面是 BitRocket 项目的核心交易页面，位于应用的首页路径 (`/`)，提供 BTC-USD 二元期权交易功能。页面包含实时价格图表、交易操作界面和用户下注管理功能。

## 🎯 主要功能

### 1. 实时价格图表 (PriceChart)

- **数据源**: Mock WebSocket 数据（120 个数据点，覆盖 2 分钟历史数据）
- **图表布局**:
  - 左侧 2/3 区域：显示 120 个历史价格数据点
  - 右侧 1/3 区域：预测区域（完全空白）
- **时间标签**: 6 个时间点，视觉上平均分布
  - 前 4 个：历史数据时间点
  - 后 2 个：预测时间（+30 秒，+60 秒）
- **动画效果**:
  - 滑动窗口动画：800ms 平滑过渡
  - 当前价格点闪烁：700ms 淡入效果
  - 水平虚线：实时价格指示线

### 2. 价格信息栏

- **交易对信息**: BTC-USD 显示
- **实时价格**: 动态更新的当前价格
- **价格变化**: 涨跌幅百分比和趋势箭头
- **颜色指示**: 绿色上涨，红色下跌

### 3. 交易操作界面

- **交易金额输入**: 支持数字输入和滑块调节
- **代币选择**: 支持多种代币（USDR, LuckyUSD）
- **交易按钮**: 看涨/看跌双向交易
- **余额显示**: 实时账户余额

### 4. 用户下注管理

- **下注记录**: 自动记录用户交易历史
- **状态跟踪**: active/settled 状态管理
- **自动清理**: 3 分钟后自动清理过期记录

## 🏗️ 技术架构

### 核心组件结构

```
src/pages/Trade/
├── index.jsx                 # 主页面组件
└── components/
    └── PriceChart/
        └── index.jsx         # 价格图表组件
```

### 数据流

1. **Mock 数据生成**: 每秒生成新的价格数据
2. **滑动窗口**: 保持 120 个数据点，新数据进入，旧数据移出
3. **图表渲染**: Chart.js 实时渲染价格曲线
4. **状态管理**: React hooks 管理组件状态

### 关键技术栈

- **图表库**: Chart.js + react-chartjs-2
- **动画**: CSS3 + Chart.js 内置动画
- **样式**: Tailwind CSS + 响应式设计
- **状态管理**: React Hooks (useState, useEffect, useMemo)

## 📱 响应式设计

### 移动端 (< 768px)

- 使用 vw 单位适配 375px 设计稿
- 图表向左偏移 4%，宽度 103%
- 字体大小：10px (X 轴) / 12px (价格标签)

### PC 端/平板 (≥ 768px)

- 最大宽度限制 428px，居中显示
- 图表不偏移，100% 宽度
- 字体大小：12px (X 轴) / 14px (价格标签)

## 🎨 视觉设计

### 颜色方案

- **主色调**: #C5FF33 (图表线条和闪烁点)
- **背景**: #121212 (深色主题)
- **上涨色**: #00bc4b
- **下跌色**: #f5384e
- **文字色**: #8f8f8f (次要文字)

### 动画效果

- **滑动窗口**: easeInOutQuart 缓动，800ms
- **价格闪烁**: 线性淡入，700ms
- **线条平滑**: tension: 0.4，borderWidth: 2

## 🔧 配置参数

### 图表配置

```javascript
// 数据点配置
totalDataPoints: 120; // 历史数据点数
totalPositions: 180; // 图表总位置数
animationDuration: 800; // 动画时长(ms)
blinkDuration: 700; // 闪烁时长(ms)

// 时间标签位置 (视觉平均分布)
timeLabels: [0, 36, 72, 107, 143, 179];
```

### 数据更新频率

- **价格数据**: 每秒更新
- **时间标签**: 每秒更新
- **图表重绘**: 实时响应数据变化

## 🚀 部署和运行

### 开发环境

```bash
# 启动开发服务器
yarn dev

# 访问地址
http://localhost:5173/
```

### 生产构建

```bash
# 构建生产版本
yarn build

# 预览构建结果
yarn preview
```

## 📊 性能优化

### 内存管理

- 滑动窗口限制数据量
- 定时清理过期下注记录
- useMemo 优化计算密集型操作

### 渲染优化

- Chart.js 硬件加速
- 动画使用 requestAnimationFrame
- 响应式断点优化

## 🔍 调试和监控

### 开发工具

- 浏览器开发者工具 Console 查看数据流
- React DevTools 监控组件状态
- Chart.js 内置调试信息

### 日志输出

- Mock 数据生成日志
- 价格更新事件日志
- 用户交易行为日志

## 📝 维护说明

### 常见问题

1. **图表不显示**: 检查数据格式和 Chart.js 配置
2. **动画卡顿**: 检查动画时长和硬件加速
3. **响应式问题**: 检查 CSS 断点和 vw 适配

### 更新指南

1. 修改数据点数量需同步更新图表配置
2. 调整动画效果需考虑性能影响
3. 响应式修改需测试多种设备尺寸

---

**最后更新**: 2025-01-08
**版本**: v1.0.0
**维护者**: BitRocket 开发团队
